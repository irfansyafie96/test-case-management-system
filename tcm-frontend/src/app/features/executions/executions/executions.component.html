<ng-container *ngIf="vm$ | async as vm">
  <div class="page-container">

    <!-- Loading State -->
    <div *ngIf="vm.loading" class="loading-overlay">
      <div class="loading-box">
        <mat-spinner diameter="32"></mat-spinner>
        <p>Loading Assigned Tasks...</p>
      </div>
    </div>

    <div class="page-header">
      <div>
        <h1 class="page-title"><mat-icon>assignment</mat-icon> My Testing Assignments</h1>
        <p class="page-subtitle">Test cases assigned to you for execution</p>
      </div>
      <button mat-raised-button color="primary" (click)="loadMyAssignedExecutions()">
        <mat-icon>refresh</mat-icon> REFRESH
      </button>
    </div>

    <!-- Content -->
    <div *ngIf="!vm.loading && !vm.error">

      <div *ngIf="vm.executions.length; else emptyState" class="content-section">
        <div class="mat-elevation-z0 table-container-styled">
          <table mat-table [dataSource]="vm.executions" class="bespoke-table">

            <!-- Test Case ID Column -->
            <ng-container matColumnDef="testCaseId">
              <th mat-header-cell *matHeaderCellDef> ID </th>
              <td mat-cell *matCellDef="let execution">
                <span class="id-badge">{{ execution.testCaseId }}</span>
              </td>
            </ng-container>

            <!-- Test Case Title Column -->
            <ng-container matColumnDef="testCaseTitle">
              <th mat-header-cell *matHeaderCellDef> TEST CASE </th>
              <td mat-cell *matCellDef="let execution" class="title-cell">
                {{ execution?.testCase?.title || execution.title }}
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> STATUS </th>
              <td mat-cell *matCellDef="let execution">
                <span class="status-badge"
                      [ngClass]="execution.overallResult ? getStatusClass(execution.overallResult) : 'not_executed'">
                  {{ execution.overallResult || 'NOT EXECUTED' }}
                </span>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> ACTIONS </th>
              <td mat-cell *matCellDef="let execution">
                <button mat-raised-button color="primary"
                        [routerLink]="['/executions/workbench', execution.id]"
                        [disabled]="execution.overallResult === 'PASS' || execution.overallResult === 'FAIL'">
                  <mat-icon>play_arrow</mat-icon> EXECUTE
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
          </table>
        </div>
      </div>

      <ng-template #emptyState>
        <div class="empty-state">
          <div class="empty-content">
            <div class="empty-icon-wrapper">
              <mat-icon class="empty-icon">assignment_late</mat-icon>
            </div>
            <h2>No Assigned Tasks</h2>
            <p>You currently have no test cases assigned to execute.</p>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Error State -->
    <div *ngIf="!vm.loading && vm.error">
      <div class="empty-state">
         <div class="empty-content">
           <mat-icon class="empty-icon error-icon">error_outline</mat-icon>
           <h3>System Error</h3>
           <p>Unable to retrieve your assigned test cases.</p>
           <button mat-raised-button color="warn" (click)="loadMyAssignedExecutions()">RETRY</button>
         </div>
      </div>
    </div>
  </div>
</ng-container>
