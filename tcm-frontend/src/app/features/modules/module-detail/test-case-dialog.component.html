<div class="dialog-header">
  <mat-icon class="dialog-icon">post_add</mat-icon>
  <h1 mat-dialog-title>Define Test Case</h1>
</div>

<div mat-dialog-content>
  <form [formGroup]="testCaseForm" class="test-case-form">
    
    <div class="row-2">
      <mat-form-field appearance="outline">
        <mat-label>ID</mat-label>
        <input 
          matInput 
          formControlName="testCaseId" 
          placeholder="TC-001"
          autocomplete="off"
          required>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Priority</mat-label>
        <mat-select formControlName="priority" required>
          <mat-option value="HIGH">High</mat-option>
          <mat-option value="MEDIUM">Medium</mat-option>
          <mat-option value="LOW">Low</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Title</mat-label>
      <input 
        matInput 
        formControlName="title" 
        placeholder="e.g. Validate User Login"
        autocomplete="off"
        required>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <textarea 
        matInput 
        formControlName="description" 
        placeholder="Brief objective..."
        rows="2"></textarea>
    </mat-form-field>
    
    <div class="steps-section-header">
      <h3>Test Steps</h3>
      <div class="step-count">{{ testSteps.length }} Steps</div>
    </div>

    <div formArrayName="testSteps" class="test-steps-container">
      <div *ngFor="let step of testSteps.controls; let i = index" [formGroupName]="i" class="test-step">
        <div class="step-marker">{{ i + 1 }}</div>
        
        <div class="step-inputs">
          <mat-form-field appearance="outline" class="compact-field">
            <mat-label>Action</mat-label>
            <input matInput formControlName="action" placeholder="Action to perform" required>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="compact-field">
            <mat-label>Expected Result</mat-label>
            <input matInput formControlName="expectedResult" placeholder="System response" required>
          </mat-form-field>
        </div>

        <button 
          type="button" 
          mat-icon-button 
          class="remove-step-btn"
          (click)="removeTestStep(i)"
          [matTooltip]="'Remove step'">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      
      <button type="button" mat-stroked-button (click)="addTestStep()" class="add-step-btn">
        <mat-icon>add</mat-icon> Add Next Step
      </button>
    </div>
  </form>
</div>

<div mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">CANCEL</button>
  <button 
    mat-raised-button 
    color="primary" 
    [mat-dialog-close]="getFormData()"
    [disabled]="!testCaseForm.valid">CREATE CASE</button>
</div>
