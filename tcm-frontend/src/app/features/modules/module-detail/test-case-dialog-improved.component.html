<h1 mat-dialog-title>{{ data?.id ? 'Edit Test Case' : 'Test Case Blueprint' }}</h1>

<div mat-dialog-content class="dialog-content">
  <p class="dialog-subtitle">Define your test scenario with steps and expected results.</p>
  
  <form [formGroup]="testCaseForm" class="test-case-form">
    
    <!-- Main Information Section -->
    <div class="form-section">
      <h3 class="section-title">Basic Information</h3>
      
      <div class="info-grid">
        <mat-form-field appearance="outline" class="id-field">
          <mat-label>Test Case ID</mat-label>
          <input
            matInput
            formControlName="testCaseId"
            placeholder="e.g., TC-001"
            required>
        </mat-form-field>

      </div>

      <mat-form-field appearance="outline" class="full-width title-field">
        <mat-label>Title</mat-label>
        <input
          matInput
          formControlName="title"
          placeholder="Enter a descriptive title..."
          required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width description-field">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          formControlName="description"
          placeholder="Provide additional details..."
          rows="2"
          cdkTextareaAutosize
          cdkAutosizeMinRows="2"
          cdkAutosizeMaxRows="6"></textarea>
      </mat-form-field>
    </div>

    <mat-divider class="bold-divider"></mat-divider>

    <!-- Test Steps Section -->
    <div class="form-section">
      <div class="steps-header-row">
        <h3 class="section-title">Test Steps <span class="step-count">({{ testSteps.length }})</span></h3>
        <button
          type="button"
          mat-stroked-button
          (click)="addTestStep()"
          color="primary"
          class="add-step-btn">
          <mat-icon>add</mat-icon> Add Step
        </button>
      </div>

      <div formArrayName="testSteps" class="test-steps-container">
        <div *ngFor="let step of testSteps.controls; let i = index" [formGroupName]="i" class="step-row">
          <div class="step-number">{{ i + 1 }}</div>
          
          <div class="step-fields">
            <mat-form-field appearance="outline" class="step-input">
              <mat-label>Action</mat-label>
              <input matInput formControlName="action" placeholder="Action" required>
            </mat-form-field>

            <mat-form-field appearance="outline" class="step-input">
              <mat-label>Expected Result</mat-label>
              <input matInput formControlName="expectedResult" placeholder="Expected Result" required>
            </mat-form-field>
          </div>

          <div class="step-actions">
            <button
              type="button"
              mat-icon-button
              [disabled]="i === 0"
              (click)="moveStepUp(i)"
              matTooltip="Move up">
              <mat-icon>keyboard_arrow_up</mat-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              [disabled]="i === testSteps.length - 1"
              (click)="moveStepDown(i)"
              matTooltip="Move down">
              <mat-icon>keyboard_arrow_down</mat-icon>
            </button>
            <button
              type="button"
              mat-icon-button
              color="warn"
              (click)="removeTestStep(i)"
              matTooltip="Remove">
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
        </div>
      </div>
      
      <div *ngIf="testSteps.length === 0" class="empty-steps">
         No steps defined. Click "Add Step" to begin.
      </div>
    </div>
  </form>
</div>

<div mat-dialog-actions align="end" class="dialog-actions">
  <button mat-button (click)="onCancel()">CANCEL</button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="!testCaseForm.valid">
    {{ data?.id ? 'SAVE CHANGES' : 'CREATE' }}
  </button>
</div>
