<div class="page-container" *ngIf="project$ | async as project">
  <div class="project-header-section">
    <div class="breadcrumb">
      <a routerLink="/projects" class="back-link">
        <mat-icon>arrow_back</mat-icon> Projects
      </a>
    </div>
    
    <div class="dossier-header">
      <div class="dossier-title">
        <h1>{{ project.name }}</h1>
        <p>{{ project.description || 'No description provided.' }}</p>
      </div>
      <div class="dossier-actions">
        <button
          *ngIf="authService.hasAnyRole(['ADMIN', 'QA', 'BA'])"
          mat-raised-button
          color="primary"
          (click)="openModuleDialog(project.id)"
          [disabled]="loading$ | async">
          <mat-icon>add</mat-icon> NEW MODULE
        </button>
      </div>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading$ | async">
    <div class="loading-box">
       <mat-spinner diameter="32"></mat-spinner>
       <p>Processing...</p>
    </div>
  </div>

  <div class="content-section">
    <div class="section-header">
      <h2><mat-icon>view_module</mat-icon> Modules Index</h2>
      <div class="count-badge">{{ project.modules?.length || 0 }} Items</div>
    </div>

    <div *ngIf="project.modules && project.modules.length > 0; else noModules">
      <div class="module-grid">
        <div
          *ngFor="let module of project.modules"
          [routerLink]="['/modules', module.id]"
          class="module-card">
          
          <div class="module-header">
            <div class="module-title-row">
              <h3>{{ module.name }}</h3>
              <button
                *ngIf="authService.hasRole('ADMIN')"
                mat-icon-button
                class="delete-btn"
                (click)="deleteModule($event, module.id)"
                [disabled]="loading$ | async"
                [matTooltip]="'Delete module'">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>

          <div class="module-stats">
            <div class="stat-item">
              <span class="stat-value">{{ module.testSuites?.length || 0 }}</span>
              <span class="stat-label">Suites</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
              <span class="stat-value">{{ getTotalTestCases(module.testSuites) }}</span>
              <span class="stat-label">Cases</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noModules>
      <div class="empty-state">
        <div class="empty-content">
          <div class="empty-icon-wrapper">
            <mat-icon class="empty-icon">view_module</mat-icon>
          </div>
          <h2>No Modules Registered</h2>
          <p *ngIf="authService.hasAnyRole(['ADMIN', 'QA', 'BA'])">This project is currently empty. Create a module to begin.</p>
          <p *ngIf="!authService.hasAnyRole(['ADMIN', 'QA', 'BA'])">This project is currently empty. Contact an administrator to create modules.</p>
        </div>
      </div>
    </ng-template>
  </div>
</div>
